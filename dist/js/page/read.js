"use strict";define(["jquery","base64"],function(s){var i=window.localStorage,n=i.getItem("menuId")||1,a=JSON.parse(i.getItem("style"))||{idx:1,size:15,bg:"#fff"},c=0;function t(e){i.setItem("menuId",n),s(".menulist li").eq(n).addClass("active").siblings().removeClass("active"),s(".wrapMask .foot .up .page").html(n+"/"+c),s.ajax({url:"/book/read?article="+n,async:!1,dataType:"json",success:function(t){var i,n,a;i=e,n=t.jsonp,(a=document.createElement("script")).src=n,window.duokan_fiction_chapter=function(t){var n=JSON.parse(s.base64().decode(t)),e="<div><h4>"+n.t+"</h4>";n.p.forEach(function(t){e+="<p>"+t+"</p>"}),e+="</div>",i?s(".insideContent").append(e):s(".insideContent").html(e),document.head.removeChild(a)},document.head.appendChild(a)}})}function e(t){var n=1*s(".wrapContent").css("font-size").slice(0,-2);20<(n+=t)?n=20:n<12&&(n=12),s(".wrapContent").css("font-size",n),a.size=n,i.setItem("style",JSON.stringify(a))}t(!1),s.ajax({url:"/book/menu",async:!1,dataType:"json",success:function(t){var e="";t.item.toc.forEach(function(t,n){e+=1===n?'<li class="active" data-id="'+t.chapter_id+'">'+t.title+"</li>":'<li data-id="'+t.chapter_id+'">'+t.title+"</li>"}),c=t.item.toc.length,s(".wrapMask .foot .up .page").html(n+"/"+c),s(".menulist").html(e)}}),s(".pattern").on("click",function(){var t,n,e=s(this).find("span");"白天"===e.html()?(e.html("夜间"),t=a.bg||"#fff",n="#000"):(e.html("白天"),t="#0f1410",n="#4e534f"),s(".wrapContent").css("color",n),s(".wrapContent").css("background",t)}),s(".wrapMask .foot .up .prev").on("click",function(){--n<=1&&(n=1),t(!1)}),s(".wrapMask .foot .up .next").on("click",function(){4<=++n&&(n=4),t(!1)}),s(".menuBtn").on("click",function(){s(".menuMask").addClass("active")}),s(".wrapContent").on("click",function(){s(".wrapMask").addClass("active")}),s(".backBtn").on("click",function(){s(".menuMask").removeClass("active")}),s(".menulist").on("click","li",function(){n=s(this).data("id"),t(!1),s(".menuMask").removeClass("active")}),s(".menulist li").eq(n).addClass("active").siblings().removeClass("active"),s(".wrapMask").on("click",function(){s(this).removeClass("active"),s(".fontStyle").removeClass("active"),s("#font").removeClass("active")}),s(".wrapMask>.foot").on("click",function(){return!1}),s(".wrapMask>.head").on("click",function(){return!1}),s("#font").on("click",function(){s(this).toggleClass("active"),s(".fontStyle").toggleClass("active")}),s(".big").on("click",function(){e(1)}),s(".small").on("click",function(){e(-1)}),s(".bg").on("click","em",function(){a.idx=s(this).index(),s(this).addClass("active").siblings().removeClass("active");var t=s(this).css("background");s(".wrapContent").css("background",t),a.bg=t,i.setItem("style",JSON.stringify(a))}),s(".wrapContent").css("font-size",a.size||15),s(".wrapContent").css("background",a.bg||"#fff"),s(".bg").children().eq(a.idx).addClass("active"),s(".wrapContent").on("scroll",function(){this.scrollTop>s(".insideContent").height()-s(this).height()+30&&(4<=++n&&(n=4),t(!0))})});